var pe=Object.defineProperty,ye=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var be=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var ie=(t,e,r)=>e in t?pe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,te=(t,e)=>{for(var r in e||(e={}))be.call(e,r)&&ie(t,r,e[r]);if(oe)for(var r of oe(e))_e.call(e,r)&&ie(t,r,e[r]);return t},ue=(t,e)=>ye(t,ge(e));var se=(t,e,r)=>new Promise((l,p)=>{var m=c=>{try{f(r.next(c))}catch(i){p(i)}},o=c=>{try{f(r.throw(c))}catch(i){p(i)}},f=c=>c.done?l(c.value):Promise.resolve(c.value).then(m,o);f((r=r.apply(t,e)).next())});import{t as O,r as _,c as R,u as ne,a as L,b as me,i as H,d as N,l as re,e as fe,f as ce,o as de,g as Se,h as Ee}from"./index-CCMnlVNk.js";function ve(t){let e=new URLSearchParams;for(let r in t){let l=t[r];l!=null&&!he(l)&&e.append(r,l)}return e.toString()}function he(t){return Object.keys(t).length===0&&t.constructor===Object}function Fe(t){let e=typeof t=="function"?t():O(t),r={};for(let l in e){let p=e[l];if(Array.isArray(p)){let[m,o]=p;if(m=O(m),o=O(o),m==="like"){if(typeof o!="string"&&(o=String(o)),o==null||o=="")continue;o.includes("%")||(o=`%${o}%`)}r[l]=[m,o]}else r[l]=O(p)}return he(r)?null:r}function $e(t){let e={};for(let r in t)e[r]=O(t[r]);return e}function I(t,e){return t?(typeof t=="string"&&(t=[t]),e&&(t=[e,...t]),JSON.stringify(t)):null}function ae(t){const{url:e,method:r="GET",params:l,immediate:p=!0,refetch:m=!1,baseUrl:o="",initialData:f,cacheKey:c,transform:i,beforeSubmit:$,onSuccess:y,onError:S}=t;let P=_(null),k,C=()=>new Promise((a,s)=>{k=a}),V=_(C());const d=R(()=>{let a;return P.value?a=P.value:typeof l=="function"?a=l():a=l,a===void 0?{}:$e(a)}),g=R(()=>{const a=`${o}${ne(e)}`;return r==="GET"&&d.value?`${a}?${ve(d.value)}`:a}),w={immediate:p,refetch:m,initialData:f,afterFetch(a){if(a.data){if(i){let h=i(a.data.data);h!==void 0&&(a.data.data=h)}let s=I(c,"useCall");if(s&&H.set(s,a.data.data),y)try{y(a.data.data)}catch(h){console.error("Error in onSuccess hook:",h)}}return a},onFetchError(a){if(S)try{S(a.error)}catch(s){console.error("Error in onError hook:",s)}return a}};let u;r==="POST"?u=L(g,w).post(d):r==="PUT"?u=L(g,w).put(d):r==="DELETE"?u=L(g,w).delete(d):u=L(g,w).get();const{data:T,error:K,isFetching:z,isFinished:le,canAbort:M,aborted:j,abort:q,execute:Q,onFetchResponse:W,onFetchError:X}=u;function v(){return Q().then(a=>{var s,h;return(h=(s=T.value)==null?void 0:s.data)!=null?h:null})}W(()=>{k(),V.value=C()}),X(a=>{k(),V.value=C()});let E=_(null);const B=a=>se(this,null,function*(){if($){E.value=null;try{yield $(a)}catch(s){console.error("Error in beforeSubmit hook:",s),E.value=s}}if(a!=null&&(P.value=a),!m)return v()}),Y=()=>{P.value=null};let U=I(c,"useCall"),J=_(null);const Z=R(()=>{var a,s;if(U&&(A.loading||!A.isFinished)){let h=J.value;if(i){let D=i(h);D!==void 0&&(h=D)}return h}return(s=(a=T.value)==null?void 0:a.data)!=null?s:null});U&&H.get(U).then(a=>{a&&(J.value=a)});let A=me({data:Z,error:N(E.value?E:K),loading:z,isFetching:z,isFinished:le,canAbort:M,aborted:j,url:g,params:d,promise:V,abort:q,execute:v,fetch:v,reload:v,reset:Y,submit:B});return A}function ke(t){const{doctype:e,fields:r,filters:l,orderBy:p,start:m,limit:o,groupBy:f,parent:c,debug:i,initialData:$,immediate:y=!0,refetch:S=!0,cacheKey:P,baseUrl:k="",url:C="",transform:V}=t,d=_(m||0),g=_(o||20),w=R(()=>{const n=l?Fe(l):null,b=r?O(r):[],F=ve({fields:b.length?JSON.stringify(b):null,filters:n?JSON.stringify(n):null,order_by:O(p),start:d.value,limit:g.value,group_by:f,parent:c,debug:i});return C?`${k}${C}?${F}`:`${k}/api/document/${e}?${F}`}),u=_(null),T=_(!0),K=R(()=>d.value>0),z={immediate:y,refetch:S,initialData:$||null,afterFetch:we(ue(te({},t),{allData:u,_start:d,_limit:g,hasNextPage:T})),onFetchError:Oe(t)},{data:le,error:M,isFetching:j,isFinished:q,canAbort:Q,aborted:W,abort:X,execute:v}=L(w,z).get();let E=I(P,"useList"),B=_(null);const Y=R(()=>{if(E&&(G.loading||!G.isFinished)){let n=B.value;if(n){if(V){let b=V(n);if(b!==void 0)return b}return n}}return u.value});E&&H.get(E).then(n=>{n&&(B.value=n)});const U=()=>{d.value+=g.value,S||v()},J=()=>{d.value=Math.max(0,d.value-g.value),S||v()},Z=n=>{if(u.value==null)return;let b=!1;for(let F of u.value)if(n.name&&n.name===F.name){for(let x in n)x in F&&n[x]!==void 0&&(F[x]=n[x],b=!0);break}b&&(u.value=[...u.value])},A=n=>{if(u.value==null)return;const b=u.value.findIndex(F=>F.name===n);b>-1&&(u.value.splice(b,1),u.value=[...u.value])},a=ae({url:`/api/document/${e}`,method:"POST",immediate:!1,refetch:!1,onSuccess(){S&&v()}}),s=_(`/api/v2/document/${e}/<name>`),h=ae({url:s,method:"PUT",baseUrl:k,immediate:!1,refetch:!1,beforeSubmit(n){n!=null&&n.name&&(s.value=`/api/v2/document/${e}/${n.name}`)},onSuccess(n){fe.setDoc(te({doctype:e},n)),re.updateRow(e,n),S&&v()}});let D=_(`/api/v2/document/${e}/<name>`);const ee=ae({url:D,method:"DELETE",immediate:!1,refetch:!1,beforeSubmit(n){n!=null&&n.name&&(D.value=`/api/v2/document/${e}/${n.name}`)},onSuccess(){if(S&&v(),ee.params.name){let{name:n}=ee.params;fe.removeDoc(e,n),re.removeRow(e,n)}}});let G=me({data:Y,hasNextPage:N(T),hasPreviousPage:K,start:N(d),limit:N(g),error:N(M),loading:j,isFetching:j,isFinished:q,canAbort:Q,aborted:W,url:w,abort:X,next:U,previous:J,execute:v,fetch:v,reload:v,updateRow:Z,removeRow:A,insert:a,setValue:h,delete:ee});return re.addList(e,G),G}function we({transform:t,onSuccess:e,cacheKey:r,allData:l,_start:p,_limit:m,hasNextPage:o}){return function(f){var c;if(f.data){let i=f.data.data;if((c=i[0])!=null&&c.name)for(let y of i)y.name=String(y.name);if(f.data.has_next_page!=null?o.value=f.data.has_next_page:o.value=!(i.length<m.value),t){const y=t(i);Array.isArray(y)&&(i=y)}p.value===0?l.value=i:l.value=[...l.value||[],...i],f.data.data=l.value;let $=I(r,"useList");if($&&H.set($,f.data.data),e)try{e(l.value)}catch(y){console.error("Error in onSuccess hook:",y)}}return f}}function Oe({onError:t}){return function(e){if(t)try{t(e.error)}catch(r){console.error("Error in onError hook:",r)}return e}}const Pe={class:"max-w-3xl py-12 mx-auto"},Ce={key:0},Te={__name:"Home",setup(t){const e=ke({doctype:"wwo-plan",fields:["name","items"],filters:[],sort_by:"modified",sort_order:"desc",limit_page_length:10,refetch:!0});return e.fetch(),console.log(e.data),(r,l)=>(de(),ce("div",Pe,[ne(e)?(de(),ce("pre",Ce,"      "+Ee(JSON.stringify(ne(e).list.data,null,2))+`
    `,1)):Se("",!0)]))}};export{Te as default};
//# sourceMappingURL=Home-Co8vqGEh.js.map
