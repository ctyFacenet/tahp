[
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<!-- Container Desktop -->\n<div class=\"lsx-ca-progress-block desktop-view\">\n    <table class=\"table table-bordered table-condensed\" id=\"lsx_ca_table\">\n        <thead>\n            <tr>\n                <th>LSX Ca</th>\n                <th>Trạng thái</th>\n                <th>Trưởng ca</th>\n                <th>Ca</th>\n                <th>Số công đoạn xong</th>\n                <th>Biên bản giao ca</th>\n            </tr>\n        </thead>\n        <tbody class=\"lsx-ca-body\">\n            <!-- JS chèn rows -->\n        </tbody>\n    </table>\n</div>\n\n<!-- Container Mobile -->\n<div class=\"lsx-ca-progress-block mobile-view\">\n    <!-- JS sẽ chèn card dạng div -->\n</div>",
  "modified": "2025-09-03 13:36:30.204928",
  "name": "Tiến độ LSX Ca",
  "private": 0,
  "roles": [],
  "script": "const desktopTbody = root_element.querySelector(\".lsx-ca-body\");\nconst mobileContainer = root_element.querySelector(\".mobile-view\");\n\nfrappe.call({\n    method: \"tahp.doc_events.work_order.before_submit.get_shift_progress\",\n    callback: function(r) {\n        desktopTbody.innerHTML = \"\";\n        mobileContainer.innerHTML = \"\";\n\n        if (r.message && r.message.length) {\n            r.message.forEach(shift => {\n                // Status badge\n                let status_html = shift.status === \"Nháp\" \n                    ? `<span class=\"badge-status badge-draft\">Nháp</span>` \n                    : `<span class=\"badge-status badge-in-progress\">Đang thực hiện</span>`;\n\n                // Desktop row\n                let progress_html = \"\";\n                if (shift.progress) {\n                    const [done, total] = shift.progress.split('/').map(Number);\n                    progress_html = `\n                        <div class=\"progress\" style=\"height:20px; border-radius:10px;\">\n                            <div class=\"progress-bar\" role=\"progressbar\" style=\"width:0%\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\">\n                                0/${total}\n                            </div>\n                        </div>\n                    `;\n                }\n\n                const tr = document.createElement(\"tr\");\n                tr.innerHTML = `\n                    <td><span class=\"lsx-link\" onclick=\"frappe.set_route('Form', 'Work Order', '${shift.lsx_ca}')\">${shift.lsx_ca}</span></td>\n                    <td>${status_html}</td>\n                    <td>${shift.shift_leader || \"\"}</td>\n                    <td>${shift.shift || \"\"}</td>\n                    <td>${progress_html}</td>\n                    <td>${shift.handover_record || \"\"}</td>\n                `;\n                desktopTbody.appendChild(tr);\n\n                // Animate desktop progress bar\n                if (shift.progress) {\n                    const [done, total] = shift.progress.split('/').map(Number);\n                    const percent = total ? Math.round((done / total) * 100) : 0;\n                    const progressBar = tr.querySelector(\".progress-bar\");\n                    setTimeout(() => {\n                        progressBar.style.width = percent + \"%\";\n                        progressBar.textContent = `${done}/${total}`;\n                        progressBar.style.backgroundColor = \"rgb(0,0,104)\";\n                    }, 50);\n                }\n\n                // Mobile card\n                const card = document.createElement(\"div\");\n                card.className = \"lsx-card\";\n                let mobileProgressHtml = \"\";\n                if (shift.progress) {\n                    const [done, total] = shift.progress.split('/').map(Number);\n                    mobileProgressHtml = `\n                        <div class=\"progress\">\n                            <div class=\"progress-bar\" style=\"width:0%\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\">0/${total}</div>\n                        </div>\n                    `;\n                }\n                card.innerHTML = `\n                    <div class=\"line1\">\n                        <span class=\"lsx-link d-flex justify-content-between w-100 mb-1\" onclick=\"frappe.set_route('Form', 'Work Order', '${shift.lsx_ca}')\">\n                            <span>${shift.lsx_ca}</span>\n                            <span>${shift.shift || \"\"}</span>\n                        </span>\n                    </div>\n                    <div class=\"line2\">\n                        ${mobileProgressHtml}\n                    </div>\n                `;\n                mobileContainer.appendChild(card);\n\n                // Animate mobile progress bar\n                if (shift.progress) {\n                    const [done, total] = shift.progress.split('/').map(Number);\n                    const percent = total ? Math.round((done / total) * 100) : 0;\n                    const mobileProgressBar = card.querySelector(\".progress-bar\");\n                    setTimeout(() => {\n                        mobileProgressBar.style.width = percent + \"%\";\n                        mobileProgressBar.textContent = `${done}/${total}`;\n                        mobileProgressBar.style.backgroundColor = \"rgb(0,0,104)\";\n                    }, 50);\n                }\n            });\n        } else {\n            desktopTbody.innerHTML = `<tr><td colspan=\"6\">Không có LSX Ca nào</td></tr>`;\n            mobileContainer.innerHTML = `<div>Không có LSX Ca nào</div>`;\n        }\n    }\n});\n",
  "style": "/* Desktop mặc định */\n.mobile-view { display: none; }\n\n/* Media query cho mobile < 768px */\n@media (max-width: 767px) {\n    .desktop-view { display: none; }\n    .mobile-view { display: block; }\n}\n\n.lsx-card {\n    border: 1px solid #ccc;\n    border-radius: 10px;\n    padding: 10px;\n    margin-bottom: 10px;\n    background-color: #f9f9f9;\n}\n.lsx-card .line1 {\n    display: flex;\n    justify-content: space-between;\n    font-weight: bold;\n    margin-bottom: 5px;\n}\n.lsx-card .line2 .progress {\n    height: 15px;\n    border-radius: 8px;\n    overflow: hidden;\n}\n.lsx-card .progress-bar {\n    width: 0%;\n    height: 15px;\n    line-height: 15px;\n    text-align: center;\n    color: #fff;\n    background-color: #ccc;\n    border-radius: 8px 0 0 8px;\n    transition: width 1.2s ease-in-out, background-color 1.2s ease-in-out;\n}\n.badge-status {\n    padding: 0.25em 0.5em;\n    border-radius: 1rem;\n    color: #fff;\n    font-size: 0.8rem;\n}\n.badge-draft { background-color: rgb(69, 179, 204); }\n.badge-in-progress { background-color: rgb(0, 0, 104); }\n.lsx-link { text-decoration: underline; cursor: pointer; }"
 }
]